# =============================================================================
# Homework AI - Backend Environment Configuration
# =============================================================================
# 复制此文件为 .env 并填写实际值
# Copy this file to .env and fill in the actual values
# =============================================================================

# -----------------------------------------------------------------------------
# Database / 数据库配置
# -----------------------------------------------------------------------------
DATABASE_URL=mysql://root:root@localhost:3306/homework_ai?connection_limit=20&pool_timeout=10
# MySQL 连接字符串，包含数据库地址、端口、用户名、密码

# -----------------------------------------------------------------------------
# Redis / Redis 配置
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379
# Redis 连接字符串，用于 BullMQ 队列和缓存

# -----------------------------------------------------------------------------
# JWT / JWT 认证配置
# -----------------------------------------------------------------------------
JWT_SECRET=dev-secret
# JWT 签名密钥，生产环境请使用强随机字符串
# Example: openssl rand -base64 32

# -----------------------------------------------------------------------------
# Storage / 对象存储配置
# -----------------------------------------------------------------------------
STORAGE_PROVIDER=minio
# 存储提供商，目前仅支持 minio

MINIO_ENDPOINT=http://localhost:9000
# MinIO 服务地址

MINIO_ACCESS_KEY=minioadmin
# MinIO 访问密钥

MINIO_SECRET_KEY=minioadmin
# MinIO 秘密密钥

MINIO_BUCKET=submissions
# 存储桶名称

MINIO_REGION=us-east-1
# MinIO 区域

# -----------------------------------------------------------------------------
# Baidu OCR / 百度 OCR 配置
# -----------------------------------------------------------------------------
# 获取地址: https://cloud.baidu.com/product/ocr/general
BAIDU_OCR_API_KEY=
# 百度 OCR API Key，留空则无法进行文字识别

BAIDU_OCR_SECRET_KEY=
# 百度 OCR Secret Key，留空则无法进行文字识别

BAIDU_OCR_TOKEN_CACHE_TTL=2592000
# OCR Token 缓存时间（秒），默认 30 天

# -----------------------------------------------------------------------------
# LLM Configuration / LLM 批改配置
# -----------------------------------------------------------------------------
# 获取地址: https://platform.deepseek.com
LLM_PROVIDER=cheap
# 默认 LLM 模式: cheap（快速模式） 或 quality（高质量模式）

LLM_PROVIDER_NAME=
# LLM 提供商名称，留空使用默认配置

LLM_API_KEY=
# DeepSeek API Key，必填项！否则无法批改

LLM_BASE_URL=
# LLM API 地址，留空使用默认 DeepSeek 地址

LLM_MODEL=
# 使用的模型名称，留空使用默认模型

LLM_MODEL_CHEAPER=
# 更便宜的模型（可选），用于快速批改

LLM_MODEL_QUALITY=
# 高质量模型（可选），用于精细批改

LLM_MAX_TOKENS=800
# LLM 最大输出 Token 数
# 注意: 建议设置为 2000 或更高，太小可能导致 JSON 响应被截断

LLM_TEMPERATURE=0.2
# LLM 温度参数（0-1），越低输出越稳定

LLM_TIMEOUT_MS=20000
# LLM 请求超时时间（毫秒）

LLM_MAX_INPUT_CHARS=6000
# 单次批改最大输入字符数

LLM_DAILY_CALL_LIMIT=400
# 每日 LLM 调用次数限制，防止超支

LLM_DAILY_TOKEN_LIMIT=
# 每日 Token 消耗限制（可选），留空不限制

# -----------------------------------------------------------------------------
# Budget / 预算控制
# -----------------------------------------------------------------------------
BUDGET_MODE=soft
# 预算模式: soft（软限制）/ hard（硬限制）

BUDGET_DAILY_LIMIT=100
# 每日预算限制（美元）

# -----------------------------------------------------------------------------
# Worker / Worker 进程配置
# -----------------------------------------------------------------------------
WORKER_CONCURRENCY=5
# Worker 并发处理任务数，根据服务器性能调整

# -----------------------------------------------------------------------------
# Data Retention / 数据保留配置
# -----------------------------------------------------------------------------
RETENTION_DAYS=7
# 数据保留天数，超过此天数的提交将被自动清理

RETENTION_DRY_RUN=false
# 是否为模拟运行（不实际删除数据）

RETENTION_BATCH_SIZE=200
# 每批处理的数据量

RETENTION_CRON=30 3 * * *
# 定时任务执行时间（Cron 表达式），默认每天凌晨 3:30

# RUN_RETENTION=true for backend-api; set false or omit for worker.
# 仅 API 服务器需要设置为 true，Worker 设置为 false
RUN_RETENTION=true

DATA_TTL_DAYS=7
# 数据生存时间（天）

# -----------------------------------------------------------------------------
# Batch Upload / 批量上传配置
# -----------------------------------------------------------------------------
BATCH_ZIP_MAX_BYTES=104857600
# ZIP 文件最大大小（字节）= 100MB

BATCH_ZIP_MAX_UNCOMPRESSED_BYTES=314572800
# 解压后最大大小（字节）= 300MB

BATCH_ZIP_MAX_ENTRY_BYTES=15728640
# 单个文件最大大小（字节）= 15MB

# -----------------------------------------------------------------------------
# Server / 服务器配置
# -----------------------------------------------------------------------------
PORT=3000
# 后端 API 服务端口

# -----------------------------------------------------------------------------
# Seed Users / 测试账号配置（仅开发环境）
# -----------------------------------------------------------------------------
SEED_USERS=false
# 是否在启动时创建测试账号，生产环境设置为 false

SEED_PASSWORD=Test1234
# 测试账号默认密码

SEED_ADMIN_ACCOUNT=admin
# 管理员账号

SEED_ADMIN_NAME=Admin
# 管理员显示名称

SEED_ADMIN_PASSWORD=
# 管理员密码，留空使用 SEED_PASSWORD

SEED_TEACHER_ACCOUNT=teacher01
# 教师账号

SEED_TEACHER_NAME=Teacher 01
# 教师显示名称

SEED_TEACHER_PASSWORD=
# 教师密码，留空使用 SEED_PASSWORD

SEED_STUDENT_ACCOUNT=student01
# 学生账号

SEED_STUDENT_NAME=Student 01
# 学生显示名称

SEED_STUDENT_PASSWORD=
# 学生密码，留空使用 SEED_PASSWORD

# =============================================================================
# Configuration Notes / 配置说明
# =============================================================================
#
# 1. 必填项 / Required:
#    - BAIDU_OCR_API_KEY 和 BAIDU_OCR_SECRET_KEY
#    - LLM_API_KEY
#
# 2. 获取 API 密钥 / How to get API keys:
#    - 百度 OCR: 访问 https://cloud.baidu.com/product/ocr
#    - DeepSeek: 访问 https://platform.deepseek.com
#
# 3. 端口配置 / Port configuration:
#    - Backend API: 3000
#    - Frontend: 3001
#    - Nginx Proxy: 80
#    - MySQL: 3306
#    - Redis: 6379
#    - MinIO: 9000 (API), 9001 (Console)
#
# 4. 常见问题 / Common issues:
#    - MAX_RETRIES_EXCEEDED 错误: 将 LLM_MAX_TOKENS 设置为 2000 或更高
#    - 提交一直 QUEUED: 确保 Worker 进程正在运行
# =============================================================================
